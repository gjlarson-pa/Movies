<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>What to Watch</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  background: #111;
  color: #fff;
  font-family: Arial, sans-serif;
  text-align: center;
  padding: 10px;
}
h1 { margin-bottom: 25px; margin-top: 15px }
#result {
  font-size: 20px;
  font-weight: bold;
  color: #f9d342;
  margin-bottom: 20px;
  height: 100px;
  line-height: 1.0;
}
#result a {
  display: block;
  margin-top: 10px;
  font-size: 12px;
  color: #4da3ff;
  text-decoration: none;
}
#result a:hover { text-decoration: underline; }
button {
  background: #28a745;
  color: white;
  border: none;
  padding: 12px 20px;
  font-size: 16px;
  cursor: pointer;
  border-radius: 6px;
  margin-bottom: 15px;
}
.checkbox-grid {
  margin: 20px auto 0;
  display: grid;
  grid-template-columns: repeat(3, auto);
  gap: 10px 8px;
  justify-content: center;
  font-size: 12px;
}
label {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
  white-space: nowrap;
}
.collapsible {
  visibility: hidden;
  height: 0;
  margin: 0;
  overflow: hidden;
}
.collapsible.show {
  visibility: visible;
  height: auto;
  margin: initial;
}
#toggleCheckboxes {
  background: #333;
  font-size: 12px;
  padding: 6px 10px;
  margin: -32px auto 0;
  display: block;
  transition: margin 0.2s ease;
}
#toggleCheckboxes.expanded {
  margin: 14px auto 0;
}
.slider-container {
  width: 90%;
  max-width: 400px;
  margin: 30px auto;
}
.slider-label { font-size: 14px; margin-bottom: 16px; }
.slider-track {
  position: relative;
  height: 12px;
  background: #444;
  border-radius: 6px;
}
.slider-range {
  position: absolute;
  height: 100%;
  background: #28a745;
  border-radius: 6px;
}
.thumb {
  position: absolute;
  top: 50%;
  width: 20px;
  height: 20px;
  background: #28a745;
  border-radius: 50%;
  transform: translate(-50%, -50%);
  cursor: pointer;
  touch-action: none;
}
.slider-values {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  margin-top: 10px;
}
@media (max-width: 450px) {
  body { padding: 15px; }
  #result { font-size: 20px; height: 120px; }
  button { font-size: 14px; padding: 10px 16px; }
  .thumb { width: 16px; height: 16px; }
  .checkbox-grid { font-size: 11px; gap: 10px 8px; }
}
</style>
</head>
<body>
<h1>What to Watch</h1>
<div id="result"></div>
<button id="pickButton" onclick="pickMovie()"><strong>Pick for Me!</strong></button>

<div class="checkbox-grid" id="checkboxGrid">
  <label><input type="checkbox" id="movie" checked> <div style="color: #f9d342;"><b>Movies</b></div></label>
  <label><input type="checkbox" id="miniseries" checked> <div style="color: #f9d342;"><b>Miniseries</b></div></label>
  <label><input type="checkbox" id="tvshow" checked> <div style="color: #f9d342;"><b>TV Shows</b></div></label>
  <label><input type="checkbox" id="top" checked> <strong> Only the Best</strong></label>
  <label><input type="checkbox" id="starwars"> Star Wars</label>
  <label><input type="checkbox" id="disney"> Disney</label>
  <label><input type="checkbox" id="adventure"> Action / Adventure</label>
  <label><input type="checkbox" id="comedy"> Comedy</label>
  <label><input type="checkbox" id="drama"> Drama</label>
  <label><input type="checkbox" id="family"> Family</label>
  <label><input type="checkbox" id="musical"> Musical</label>
  <label><input type="checkbox" id="scifi"> Sci-Fi / Fantasy</label>

  <label class="collapsible"><input type="checkbox" id="documentary"> Documentary</label>
  <label class="collapsible"><input type="checkbox" id="standup"> Stand-up</label>
  <label class="collapsible"><input type="checkbox" id="variety"> Variety</label>
  <label class="collapsible"><input type="checkbox" id="biopic"> Biography</label>
  <label class="collapsible"><input type="checkbox" id="crime"> Crime</label>
  <label class="collapsible"><input type="checkbox" id="history"> History</label>
  <label class="collapsible"><input type="checkbox" id="Horror"> Horror</label>
  <label class="collapsible"><input type="checkbox" id="mystery"> Mystery</label>
  <label class="collapsible"><input type="checkbox" id="romance"> Romance</label>
  <label class="collapsible"><input type="checkbox" id="sports"> Sports</label>
  <label class="collapsible"><input type="checkbox" id="serial"> Serials</label>
  <label class="collapsible"><input type="checkbox" id="sitcom"> Sitcoms</label>
  <label class="collapsible"><input type="checkbox" id="halloween"> Halloween</label>
  <label class="collapsible"><input type="checkbox" id="christmas"> Christmas</label>
</div>

<button id="toggleCheckboxes">See More â–¼</button>

<div class="slider-container">
  <div class="slider-label">Years: <span id="yearValue">1920-2025</span></div>
  <div class="slider-track" id="sliderTrack">
    <div class="slider-range" id="sliderRange"></div>
    <div class="thumb" id="thumbMin"></div>
    <div class="thumb" id="thumbMax"></div>
  </div>
  <div class="slider-values"></div>
</div>

<script src="movies.js"></script>

<script>
const toggleBtn = document.getElementById("toggleCheckboxes");
const collapsibles = document.querySelectorAll(".collapsible");
let expanded = false;

toggleBtn.addEventListener("click", () => {
  expanded = !expanded;
  collapsibles.forEach(c => c.classList.toggle("show", expanded));
  toggleBtn.textContent = expanded ? "See Less â–²" : "See More â–¼";
  toggleBtn.classList.toggle("expanded", expanded);
});

const typeCheckboxes = [
  document.getElementById('movie'),
  document.getElementById('miniseries'),
  document.getElementById('tvshow')
];

const genreCheckboxes = Array.from(
  document.querySelectorAll('.checkbox-grid input[type="checkbox"]')
).filter(cb => !typeCheckboxes.includes(cb));

const topCheckbox = document.getElementById('top');

function enforceAtLeastOne(checkboxes) {
  checkboxes.forEach(cb => {
    cb.addEventListener("change", () => {
      const checked = checkboxes.filter(c => c.checked);
      if (checked.length === 0) {
        cb.checked = true;
      }
    });
  });
}
enforceAtLeastOne(typeCheckboxes);
enforceAtLeastOne(genreCheckboxes);

topCheckbox.addEventListener("change", () => {
  if (topCheckbox.checked) {
    genreCheckboxes.forEach(cb => {
      if (cb !== topCheckbox) cb.checked = false;
    });
  }
});
genreCheckboxes.forEach(cb => {
  if (cb !== topCheckbox) {
    cb.addEventListener("change", () => {
      if (cb.checked) {
        topCheckbox.checked = false;
      }
    });
  }
});

const track = document.getElementById('sliderTrack');
const range = document.getElementById('sliderRange');
const thumbMin = document.getElementById('thumbMin');
const thumbMax = document.getElementById('thumbMax');
const yearValue = document.getElementById('yearValue');
const sliderMin = 1920;
const sliderMax = 2030;
let currentMin = 1925;
let currentMax = 2025;

function updateSliderUI() {
  const percentMin = ((currentMin - sliderMin)/(sliderMax - sliderMin))*100;
  const percentMax = ((currentMax - sliderMin)/(sliderMax - sliderMin))*100;
  thumbMin.style.left = percentMin + '%';
  thumbMax.style.left = percentMax + '%';
  range.style.left = percentMin + '%';
  range.style.width = (percentMax - percentMin) + '%';
  yearValue.textContent = `${currentMin}-${currentMax}`;
}
function dragThumb(thumb, isMin) {
  let dragging = false;
  const startDrag = e => { dragging = true; e.preventDefault(); };
  const stopDrag = () => dragging = false;
  const onDrag = e => {
    if (!dragging) return;
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const rect = track.getBoundingClientRect();
    let percent = ((clientX - rect.left) / rect.width) * 100;
    percent = Math.max(0, Math.min(100, percent));
    const value = Math.round(sliderMin + (percent/100)*(sliderMax-sliderMin));
    if (isMin) currentMin = Math.min(value, currentMax);
    else currentMax = Math.max(value, currentMin);
    updateSliderUI();
  };
  thumb.addEventListener('mousedown', startDrag);
  thumb.addEventListener('touchstart', startDrag);
  document.addEventListener('mousemove', onDrag);
  document.addEventListener('touchmove', onDrag);
  document.addEventListener('mouseup', stopDrag);
  document.addEventListener('touchend', stopDrag);
}
dragThumb(thumbMin, true);
dragThumb(thumbMax, false);
updateSliderUI();

// --- Pick movie ---
function pickMovie() {
  const selectedTypes = typeCheckboxes.filter(cb => cb.checked).map(cb => cb.id);
  const selectedGenres = genreCheckboxes.filter(cb => cb.checked).map(cb => cb.id);

  const filtered = movies.filter(m => {
    const start = m.year;
    const end = (m.length ? m.year + m.length - 1 : m.year);

    return (
      start <= currentMax &&
      end >= currentMin &&
      m.type.some(t => selectedTypes.includes(t)) &&
      (selectedGenres.includes('top') ? m.genres.includes('top') :
        selectedGenres.length === 0 || m.genres.some(g => selectedGenres.includes(g)))
    );
  });

  const resultDiv = document.getElementById('result');

  if (filtered.length === 0) {
    resultDiv.textContent = "No matching titles found, please expand your selections.";
    return;
  }

  // ðŸ”¹ New check for fewer than 3 results
  if (filtered.length < 3) {
    resultDiv.textContent = "Not enough titles, please expand your selections.";
    return;
  }

  // Weighted pool if 2â€“3 genres
  let weightedPool;
  if (selectedGenres.length > 1 && selectedGenres.length <= 3 && !selectedGenres.includes('top')) {
    weightedPool = [];
    filtered.forEach(movie => {
      const matches = movie.genres.filter(g => selectedGenres.includes(g)).length;
      for (let i = 0; i < matches; i++) {
        weightedPool.push(movie);
      }
    });
  } else {
    weightedPool = filtered.slice();
  }

  const totalFlashes = 18, flashInterval = 50;
  let flashes = 0;
  const flashTimer = setInterval(() => {
    const tempChoice = weightedPool[Math.floor(Math.random()*weightedPool.length)];
    resultDiv.innerHTML = `<em>${tempChoice.name}</em> <small>(${tempChoice.year})</small>`;
    flashes++;
    if (flashes >= totalFlashes) {
      clearInterval(flashTimer);
      const finalChoice = weightedPool[Math.floor(Math.random()*weightedPool.length)];
      const googleSearch = `https://www.google.com/search?q=${encodeURIComponent(finalChoice.name + ' (' + finalChoice.year + ') streaming')}`;
      resultDiv.innerHTML = `
        <em>${finalChoice.name}</em> <small>(${finalChoice.year})</small>
        <a href="${googleSearch}" target="_blank">ðŸ”Ž Search on Google</a>
      `;
    }
  }, flashInterval);
}
</script>
<p style="font-size: 12px; color: #808080;">
[ <a href="https://forms.gle/mHgL7tzYGadhfRH68" style="color: #4da3ff;">Suggest a Title</a> ]</p>
<p style="font-size: 12px; color: #808080;">Created by Greg</p>

</body>
</html>
