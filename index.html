<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>What to Watch</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  background: #111;
  color: #fff;
  font-family: Arial, sans-serif;
  text-align: center;
  padding: 20px;
}
h1 { margin-bottom: 20px; }
#result {
  font-size: 20px;
  font-weight: bold;
  color: #f9d342;
  margin-bottom: 30px;
  height: 125px;
  line-height: 1.0;
}
#result a {
  display: block;
  margin-top: 10px;
  font-size: 12px;
  color: #4da3ff;
  text-decoration: none;
}
#result a:hover { text-decoration: underline; }
button {
  background: #28a745;
  color: white;
  border: none;
  padding: 12px 20px;
  font-size: 16px;
  cursor: pointer;
  border-radius: 6px;
  margin-bottom: 20px;
}
.checkbox-grid {
  margin: 20px auto;
  display: grid;
  grid-template-columns: repeat(3, auto);
  gap: 12px 15px;
  justify-content: center;
  font-size: 12px;
}
label {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
  white-space: nowrap;
}
.slider-container {
  width: 90%;
  max-width: 400px;
  margin: 30px auto;
}
.slider-label { font-size: 14px; margin-bottom: 16px; }
.slider-track {
  position: relative;
  height: 12px;
  background: #444;
  border-radius: 6px;
}
.slider-range {
  position: absolute;
  height: 100%;
  background: #28a745;
  border-radius: 6px;
}
.thumb {
  position: absolute;
  top: 50%;
  width: 20px;
  height: 20px;
  background: #28a745;
  border-radius: 50%;
  transform: translate(-50%, -50%);
  cursor: pointer;
  touch-action: none;
}
.slider-values {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  margin-top: 10px;
}
@media (max-width: 480px) {
  body { padding: 15px; }
  #result { font-size: 20px; height: 140px; }
  button { font-size: 14px; padding: 10px 16px; }
  .thumb { width: 16px; height: 16px; }
  .checkbox-grid { font-size: 11px; gap: 10px 8px; }
}
</style>
</head>
<body>

<h1>What to Watch</h1>
<div id="result"></div>
<button id="pickButton" onclick="pickMovie()">Surprise Me!</button>

<div class="checkbox-grid">
  <label><input type="checkbox" id="movie" checked> <div style="color: #f9d342;"><b>Movies</b></div></label>
  <label><input type="checkbox" id="serial" checked> <div style="color: #f9d342;"><b>Serials</b></div></label>
  <label><input type="checkbox" id="tvshow" checked> <div style="color: #f9d342;"><b>TV Shows</b></div></label>
  <label><input type="checkbox" id="starwars" checked> Star Wars</label>
  <label><input type="checkbox" id="disney" checked> Disney</label>
  <label><input type="checkbox" id="action" checked> Action / Adventure</label>
  <label><input type="checkbox" id="comedy" checked> Comedy</label>
  <label><input type="checkbox" id="drama" checked> Drama</label>
  <label><input type="checkbox" id="family" checked> Family</label>
  <label><input type="checkbox" id="musical" checked> Musical</label>
  <label><input type="checkbox" id="mystery" checked> Mystery</label>
  <label><input type="checkbox" id="scifi" checked> Sci-Fi / Fantasy</label>
  <label><input type="checkbox" id="documentary"> Documentary</label>
  <label><input type="checkbox" id="standup"> Stand-up</label>
  <label><input type="checkbox" id="halloween"> Halloween</label>
  <label><input type="checkbox" id="christmas"> Christmas</label>
  <label><input type="checkbox" id="top"> Favorites Only</label>
</div>

<div class="slider-container">
  <div class="slider-label">Year: <span id="yearValue">1920-2025</span></div>
  <div class="slider-track" id="sliderTrack">
    <div class="slider-range" id="sliderRange"></div>
    <div class="thumb" id="thumbMin"></div>
    <div class="thumb" id="thumbMax"></div>
  </div>
  <div class="slider-values">
    <span>1920</span>
    <span>2030</span>
  </div>
</div>

<!-- Include movies.js -->
<script src="movies.js"></script>

<script>
// Type checkboxes logic
const typeCheckboxes = [document.getElementById('movie'), document.getElementById('serial'), document.getElementById('tvshow')];
typeCheckboxes.forEach(cb => cb.addEventListener('change', () => {
  if (!typeCheckboxes.some(c => c.checked)) cb.checked = true;
}));

// Genre checkboxes logic
const topCheckbox = document.getElementById('top');
const genreCheckboxes = Array.from(document.querySelectorAll('.checkbox-grid input[type="checkbox"]')).filter(cb => !typeCheckboxes.includes(cb));
topCheckbox.addEventListener('change', () => {
  if (topCheckbox.checked) genreCheckboxes.forEach(cb => { if (cb !== topCheckbox) cb.checked = false; });
});
genreCheckboxes.forEach(cb => {
  if (cb !== topCheckbox) cb.addEventListener('change', () => { if (cb.checked) topCheckbox.checked = false; });
});

// Dual-thumb slider logic
const track = document.getElementById('sliderTrack');
const range = document.getElementById('sliderRange');
const thumbMin = document.getElementById('thumbMin');
const thumbMax = document.getElementById('thumbMax');
const yearValue = document.getElementById('yearValue');
const sliderMin = 1920;
const sliderMax = 2030;
let currentMin = 1925;
let currentMax = 2025;

function updateSliderUI() {
  const percentMin = ((currentMin - sliderMin)/(sliderMax - sliderMin))*100;
  const percentMax = ((currentMax - sliderMin)/(sliderMax - sliderMin))*100;
  thumbMin.style.left = percentMin + '%';
  thumbMax.style.left = percentMax + '%';
  range.style.left = percentMin + '%';
  range.style.width = (percentMax - percentMin) + '%';
  yearValue.textContent = `${currentMin}-${currentMax}`;
}

function dragThumb(thumb, isMin) {
  let dragging = false;
  const startDrag = e => { dragging = true; e.preventDefault(); };
  const stopDrag = () => dragging = false;
  const onDrag = e => {
    if (!dragging) return;
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const rect = track.getBoundingClientRect();
    let percent = ((clientX - rect.left) / rect.width) * 100;
    percent = Math.max(0, Math.min(100, percent));
    const value = Math.round(sliderMin + (percent/100)*(sliderMax-sliderMin));
    if (isMin) currentMin = Math.min(value, currentMax);
    else currentMax = Math.max(value, currentMin);
    updateSliderUI();
  };
  thumb.addEventListener('mousedown', startDrag);
  thumb.addEventListener('touchstart', startDrag);
  document.addEventListener('mousemove', onDrag);
  document.addEventListener('touchmove', onDrag);
  document.addEventListener('mouseup', stopDrag);
  document.addEventListener('touchend', stopDrag);
}

dragThumb(thumbMin, true);
dragThumb(thumbMax, false);
updateSliderUI();

// Pick movie function using movies from movies.js
function pickMovie() {
  const selectedTypes = typeCheckboxes.filter(cb => cb.checked).map(cb => cb.id);
  const selectedGenres = genreCheckboxes.filter(cb => cb.checked).map(cb => cb.id);
  const filtered = movies.filter(m => 
    m.year >= currentMin &&
    m.year <= currentMax &&
    m.type.some(t => selectedTypes.includes(t)) &&
    (selectedGenres.includes('top') ? m.genres.includes('top') : selectedGenres.length === 0 || m.genres.some(g => selectedGenres.includes(g)))
  );
  if (filtered.length === 0) {
    document.getElementById('result').textContent = "No matching titles found.";
    return;
  }

  const choice = filtered[Math.floor(Math.random()*filtered.length)];
  const resultDiv = document.getElementById('result');
  const googleSearch = `https://www.google.com/search?q=${encodeURIComponent(choice.name + ' (' + choice.year + ') streaming')}`;

  resultDiv.innerHTML = `
    <em>${choice.name}</em> <small>(${choice.year})</small>
    <a href="${googleSearch}" target="_blank">ðŸ”Ž Search on Google</a>
  `;
}
</script>

</body>
</html>
